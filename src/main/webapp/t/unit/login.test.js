describe("User login ", function() {

    var taxScope, taxCtrl, loginScope, loginCtrl;
    var httpBackend;
    var userState;
    beforeEach(module('xdApp'));

    beforeEach(function() {
        inject(function($rootScope,$state, $controller, _$httpBackend_) {
            httpBackend = _$httpBackend_;

            spyOn($state, 'go').and.callFake(function(state, params) {
               userState = state; 
            });

            taxScope = $rootScope.$new();
            taxCtrl = $controller('taxController',{$scope : taxScope});

            loginScope = taxScope.$new();
            loginCtrl = $controller('LoginCtrl', { '$scope': loginScope });
        });
    });

    it("use name and password", function() {
        httpBackend.when('GET',/.*html$/).respond();
        httpBackend.when('POST','../user/userLogin.cmd').respond({"data":{"id":-10,"name":"a","password":"0cc175b9c0f1b6a831c399e269772661","birthday":null,"sex":0,"entryTime":null,"mobile":null,"phone":null,"idCard":null,"mail":"a@a.com","dept":{"id":1,"name":"事业部","parent":0,"roles":[]},"roles":[{"id":-2,"name":"管理员","mods":[{"id":1,"name":"系统配置","url":null,"routerId":null,"addition":"fa fa-user-secret","parentId":0},{"id":2,"name":"用户管理","url":null,"routerId":"user","addition":"fa fa-user","parentId":1},{"id":3,"name":"动态参数","url":null,"routerId":"conf","addition":"fa fa-pencil","parentId":1},{"id":4,"name":"新增用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":5,"name":"查看用户","url":"/user/obtainUsers","routerId":null,"addition":null,"parentId":2},{"id":6,"name":"删除用户","url":"/user/deleteUser","routerId":null,"addition":null,"parentId":2},{"id":7,"name":"修改用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":8,"name":"新增角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":9,"name":"查看角色","url":"/role/obtainRoles","routerId":null,"addition":null,"parentId":2},{"id":10,"name":"删除角色","url":"/role/deleteRole","routerId":null,"addition":null,"parentId":2},{"id":11,"name":"修改角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":12,"name":"查看部门","url":"/dept/obtainDepts","routerId":null,"addition":null,"parentId":2},{"id":13,"name":"商品管理","url":null,"routerId":null,"addition":"fa fa-truck","parentId":0},{"id":14,"name":"商品导入及审核","url":null,"routerId":"product","addition":"fa fa-truck","parentId":13},{"id":16,"name":"新增商品","url":"/product/saveProduct","routerId":null,"addition":null,"parentId":14},{"id":17,"name":"查看商品","url":"/product/obtainProducts","routerId":null,"addition":null,"parentId":14},{"id":18,"name":"删除商品","url":"/product/deleteProduct","routerId":null,"addition":null,"parentId":14},{"id":19,"name":"审批商品","url":"/product/approveProduct","routerId":null,"addition":null,"parentId":14},{"id":20,"name":"审批导入","url":"/product-import/approveProductImport","routerId":null,"addition":null,"parentId":14},{"id":21,"name":"项目管理","url":null,"routerId":null,"addition":"fa fa-calendar-check-o","parentId":0},{"id":22,"name":"项目新建与查询","url":null,"routerId":"project","addition":"fa fa-calendar-minus-o","parentId":21},{"id":23,"name":"项目预算管理","url":null,"routerId":"budget","addition":"fa fa-calendar-times-o","parentId":21},{"id":24,"name":"新建项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":25,"name":"修改项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":26,"name":"导出项目","url":"/project/exportProject","routerId":null,"addition":null,"parentId":22},{"id":27,"name":"查询项目","url":"/project/obtainProject","routerId":null,"addition":null,"parentId":22},{"id":28,"name":"删除预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":29,"name":"导入预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":30,"name":"查看预算","url":"/budget/obtainBudgets","routerId":null,"addition":null,"parentId":23},{"id":31,"name":"项目进度管理","url":null,"routerId":"progress","addition":"fa fa-list-ol","parentId":21},{"id":33,"name":"查看工程进度","url":"/construction-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":34,"name":"新建工程进度","url":"/construction-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":35,"name":"查看合同进度","url":"/contract-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":36,"name":"新建合同进度","url":"/contract-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":37,"name":"项目预算测算管理","url":null,"routerId":"calculate","addition":"fa fa-calculator","parentId":21},{"id":38,"name":"预算进项税计算","url":"/calculate/obtainCalculate","routerId":null,"addition":null,"parentId":37},{"id":39,"name":"预算税负计算","url":"/calculate/showTaxCalculate","routerId":null,"addition":null,"parentId":37},{"id":40,"name":"各部分采购","url":null,"routerId":null,"addition":"fa fa-shopping-cart","parentId":0},{"id":41,"name":"供应商管理","url":null,"routerId":"supplier","addition":"fa fa-address-book-o","parentId":40},{"id":42,"name":"新增供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":43,"name":"修改供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":44,"name":"采购成本税收测算","url":null,"routerId":"cost-tax","addition":"fa fa-asterisk","parentId":40},{"id":45,"name":"测算","url":null,"routerId":null,"addition":null,"parentId":44},{"id":46,"name":"实际实施采购管理","url":null,"routerId":"purchase","addition":"fa fa-shopping-cart","parentId":40},{"id":47,"name":"税务分析管理","url":null,"routerId":null,"addition":"fa fa-cogs","parentId":0},{"id":48,"name":"项目收款管理","url":null,"routerId":"receipt","addition":"fa fa-credit-card-alt","parentId":47},{"id":49,"name":"税收管理分析","url":null,"routerId":"tax-manager","addition":"fa fa-bookmark-o","parentId":47},{"id":50,"name":"纳税人身份管理","url":null,"routerId":"tax-man-manager","addition":"fa fa-address-book","parentId":47},{"id":51,"name":"税收分析与管理建议","url":null,"routerId":"advise","addition":"fa fa-envira","parentId":47}]}]}});
        httpBackend.when('POST','../dept/obtainDepts.cmd').respond({"data":[{"id":0,"name":"公司","parent":-1,"roles":[{"id":-2,"name":"管理员","mods":[{"id":1,"name":"系统配置","url":null,"routerId":null,"addition":"fa fa-user-secret","parentId":0},{"id":2,"name":"用户管理","url":null,"routerId":"user","addition":"fa fa-user","parentId":1},{"id":3,"name":"动态参数","url":null,"routerId":"conf","addition":"fa fa-pencil","parentId":1},{"id":4,"name":"新增用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":5,"name":"查看用户","url":"/user/obtainUsers","routerId":null,"addition":null,"parentId":2},{"id":6,"name":"删除用户","url":"/user/deleteUser","routerId":null,"addition":null,"parentId":2},{"id":7,"name":"修改用户","url":"/user/saveUser","routerId":null,"addition":null,"parentId":2},{"id":8,"name":"新增角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":9,"name":"查看角色","url":"/role/obtainRoles","routerId":null,"addition":null,"parentId":2},{"id":10,"name":"删除角色","url":"/role/deleteRole","routerId":null,"addition":null,"parentId":2},{"id":11,"name":"修改角色","url":"/role/saveRole","routerId":null,"addition":null,"parentId":2},{"id":12,"name":"查看部门","url":"/dept/obtainDepts","routerId":null,"addition":null,"parentId":2},{"id":13,"name":"商品管理","url":null,"routerId":null,"addition":"fa fa-truck","parentId":0},{"id":14,"name":"商品导入及审核","url":null,"routerId":"product","addition":"fa fa-truck","parentId":13},{"id":16,"name":"新增商品","url":"/product/saveProduct","routerId":null,"addition":null,"parentId":14},{"id":17,"name":"查看商品","url":"/product/obtainProducts","routerId":null,"addition":null,"parentId":14},{"id":18,"name":"删除商品","url":"/product/deleteProduct","routerId":null,"addition":null,"parentId":14},{"id":19,"name":"审批商品","url":"/product/approveProduct","routerId":null,"addition":null,"parentId":14},{"id":20,"name":"审批导入","url":"/product-import/approveProductImport","routerId":null,"addition":null,"parentId":14},{"id":21,"name":"项目管理","url":null,"routerId":null,"addition":"fa fa-calendar-check-o","parentId":0},{"id":22,"name":"项目新建与查询","url":null,"routerId":"project","addition":"fa fa-calendar-minus-o","parentId":21},{"id":23,"name":"项目预算管理","url":null,"routerId":"budget","addition":"fa fa-calendar-times-o","parentId":21},{"id":24,"name":"新建项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":25,"name":"修改项目","url":"/project/saveProject","routerId":null,"addition":null,"parentId":22},{"id":26,"name":"导出项目","url":"/project/exportProject","routerId":null,"addition":null,"parentId":22},{"id":27,"name":"查询项目","url":"/project/obtainProject","routerId":null,"addition":null,"parentId":22},{"id":28,"name":"删除预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":29,"name":"导入预算","url":"/budget/deleteBudget","routerId":null,"addition":null,"parentId":23},{"id":30,"name":"查看预算","url":"/budget/obtainBudgets","routerId":null,"addition":null,"parentId":23},{"id":31,"name":"项目进度管理","url":null,"routerId":"progress","addition":"fa fa-list-ol","parentId":21},{"id":33,"name":"查看工程进度","url":"/construction-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":34,"name":"新建工程进度","url":"/construction-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":35,"name":"查看合同进度","url":"/contract-progress/obtainProgresses","routerId":null,"addition":null,"parentId":31},{"id":36,"name":"新建合同进度","url":"/contract-progress/saveProgress","routerId":null,"addition":null,"parentId":31},{"id":37,"name":"项目预算测算管理","url":null,"routerId":"calculate","addition":"fa fa-calculator","parentId":21},{"id":38,"name":"预算进项税计算","url":"/calculate/obtainCalculate","routerId":null,"addition":null,"parentId":37},{"id":39,"name":"预算税负计算","url":"/calculate/showTaxCalculate","routerId":null,"addition":null,"parentId":37},{"id":40,"name":"各部分采购","url":null,"routerId":null,"addition":"fa fa-shopping-cart","parentId":0},{"id":41,"name":"供应商管理","url":null,"routerId":"supplier","addition":"fa fa-address-book-o","parentId":40},{"id":42,"name":"新增供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":43,"name":"修改供应商","url":"supplier/saveSupplier","routerId":null,"addition":null,"parentId":41},{"id":44,"name":"采购成本税收测算","url":null,"routerId":"cost-tax","addition":"fa fa-asterisk","parentId":40},{"id":45,"name":"测算","url":null,"routerId":null,"addition":null,"parentId":44},{"id":46,"name":"实际实施采购管理","url":null,"routerId":"purchase","addition":"fa fa-shopping-cart","parentId":40},{"id":47,"name":"税务分析管理","url":null,"routerId":null,"addition":"fa fa-cogs","parentId":0},{"id":48,"name":"项目收款管理","url":null,"routerId":"receipt","addition":"fa fa-credit-card-alt","parentId":47},{"id":49,"name":"税收管理分析","url":null,"routerId":"tax-manager","addition":"fa fa-bookmark-o","parentId":47},{"id":50,"name":"纳税人身份管理","url":null,"routerId":"tax-man-manager","addition":"fa fa-address-book","parentId":47},{"id":51,"name":"税收分析与管理建议","url":null,"routerId":"advise","addition":"fa fa-envira","parentId":47}]},{"id":-1,"name":"副总经理","mods":[]},{"id":0,"name":"总经理","mods":[]}]},{"id":1,"name":"事业部","parent":0,"roles":[]},{"id":2,"name":"工程事业部","parent":1,"roles":[]},{"id":3,"name":"财务部","parent":2,"roles":[{"id":1,"name":"会计","mods":[]}]},{"id":4,"name":"合同预算部","parent":2,"roles":[{"id":2,"name":"预算员","mods":[]}]},{"id":5,"name":"材料供应部","parent":2,"roles":[{"id":3,"name":"材料员","mods":[]}]},{"id":6,"name":"市场经营部","parent":2,"roles":[{"id":4,"name":"操作员(4)","mods":[]}]},{"id":7,"name":"行政办公司","parent":2,"roles":[{"id":5,"name":"操作员(5)","mods":[]}]},{"id":8,"name":"机械设备部","parent":2,"roles":[{"id":6,"name":"操作员(6)","mods":[]}]},{"id":9,"name":"劳务管理部","parent":2,"roles":[{"id":7,"name":"操作员(7)","mods":[]}]},{"id":10,"name":"信息管理部","parent":2,"roles":[{"id":8,"name":"操作员(8)","mods":[]}]},{"id":11,"name":"安全环保部","parent":2,"roles":[{"id":9,"name":"操作员(9)","mods":[]}]},{"id":12,"name":"质量检查部","parent":2,"roles":[{"id":10,"name":"操作员(10)","mods":[]}]},{"id":13,"name":"法务清欠部","parent":2,"roles":[{"id":11,"name":"操作员(11)","mods":[]}]}],"total":14});
        
        loginScope.login();
        httpBackend.flush();
        // 成功转到 user界面 
        expect(userState).toBe('user');

    });
});
